<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Atheer Suite — Test Lab</title>
  <link rel="stylesheet" href="assets/styles.css" />
  <meta name="description" content="Atheer Suite — بيئة اختبار ومحاكاة للمدفوعات NFC/SoftPOS في شبكات مقيدة." />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">A</div>
      <div>
        <div class="title">Atheer Suite</div>
        <div class="subtitle">Test Lab • Scenarios • Evidence</div>
      </div>
    </div>

    <nav class="tabs" role="tablist" aria-label="Atheer Tabs">
      <button class="tab active" data-tab="lab">المختبر</button>
      <button class="tab" data-tab="results">النتائج</button>
      <button class="tab" data-tab="logs">السجلات</button>
      <button class="tab" data-tab="artifacts">الملفات</button>
      <button class="tab" data-tab="map">خريطة النظام</button>
      <button class="tab" data-tab="local">تشغيل محلي</button>
    </nav>
  </header>

  <main class="container">
    <!-- LAB -->
    <section class="panel show" id="tab-lab">
      <div class="grid2">
        <div class="card">
          <h2>Scenario Builder</h2>
          <p class="muted">ابنِ سيناريو اختبار قابل لإعادة التجربة (Reproducible) واحصل على Scenario ID.</p>

          <div class="form">
            <div class="row">
              <label>نوع الشبكة</label>
              <select id="netType">
                <option value="private_apn">Private APN (شبكة مغلقة)</option>
                <option value="public_internet">Public Internet</option>
              </select>
            </div>

            <div class="row">
              <label>Latency (ms)</label>
              <input id="latency" type="number" min="0" value="65" />
            </div>

            <div class="row">
              <label>Jitter (ms)</label>
              <input id="jitter" type="number" min="0" value="15" />
            </div>

            <div class="row">
              <label>Packet Loss (%)</label>
              <input id="loss" type="number" min="0" max="30" value="2" />
            </div>

            <div class="row">
              <label>Bandwidth (kbps)</label>
              <input id="bw" type="number" min="64" value="512" />
            </div>

            <div class="row">
              <label>Transaction Mix</label>
              <select id="mix">
                <option value="tap_to_pay">Tap-to-Pay</option>
                <option value="provisioning">Token Provisioning</option>
                <option value="mixed">Mixed</option>
              </select>
            </div>

            <div class="row">
              <label>عدد التجارب (n)</label>
              <input id="n" type="number" min="10" value="1000" />
            </div>

            <div class="row">
              <label>Seed (لإعادة نفس النتائج)</label>
              <input id="seed" type="number" min="1" value="42" />
            </div>
          </div>

          <div class="actions">
            <button class="btn primary" id="runBtn">تشغيل الاختبار</button>
            <button class="btn" id="saveScenarioBtn">حفظ السيناريو</button>
            <span class="pill" id="scenarioIdPill" title="Scenario ID">Scenario: —</span>
          </div>

          <div class="hint">
            <strong>مهم:</strong> هذا محاكي داخل المتصفح (Mock Lab). لاحقًا تقدر تربطه بخدمات وهمية على VPS أو Docker.
          </div>
        </div>

        <div class="card">
          <h2>Live Summary</h2>
          <div class="kpis">
            <div class="kpi">
              <div class="k">متوسط الزمن</div>
              <div class="v" id="kpiAvg">—</div>
              <div class="s">ms</div>
            </div>
            <div class="kpi">
              <div class="k">P95</div>
              <div class="v" id="kpiP95">—</div>
              <div class="s">ms</div>
            </div>
            <div class="kpi">
              <div class="k">Error Rate</div>
              <div class="v" id="kpiErr">—</div>
              <div class="s">%</div>
            </div>
            <div class="kpi">
              <div class="k">Retries</div>
              <div class="v" id="kpiRetry">—</div>
              <div class="s">%</div>
            </div>
          </div>

          <div class="chartbox">
            <canvas id="chart" width="900" height="360" aria-label="Latency chart"></canvas>
          </div>

          <div class="muted small">
            يتم حفظ آخر 20 تشغيل في المتصفح (LocalStorage) لعرض المقارنات.
          </div>
        </div>
      </div>
    </section>

    <!-- RESULTS -->
    <section class="panel" id="tab-results">
      <div class="card">
        <h2>Runs & Comparisons</h2>
        <p class="muted">قارن بين التشغيلات عبر الزمن، وشاهد P50/P95/P99 ومعدل الأخطاء.</p>

        <div class="actions">
          <button class="btn" id="clearRunsBtn">حذف كل التشغيلات</button>
          <button class="btn" id="exportRunsJsonBtn">تصدير كل التشغيلات JSON</button>
        </div>

        <div class="tablewrap">
          <table>
            <thead>
              <tr>
                <th>الوقت</th>
                <th>Scenario</th>
                <th>n</th>
                <th>AVG</th>
                <th>P95</th>
                <th>P99</th>
                <th>Errors</th>
                <th>Retries</th>
                <th>فتح</th>
              </tr>
            </thead>
            <tbody id="runsTbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- LOGS -->
    <section class="panel" id="tab-logs">
      <div class="card">
        <h2>Logs</h2>
        <p class="muted">سجلات قابلة للفرز والتصفية والتصدير — مفيدة للـ evidence.</p>

        <div class="grid2">
          <div class="form">
            <div class="row">
              <label>فلترة حسب Component</label>
              <select id="logComp">
                <option value="all">All</option>
                <option value="client">Client</option>
                <option value="network">Network</option>
                <option value="token">Token Service</option>
                <option value="host">Mock Host</option>
                <option value="risk">Risk Engine</option>
              </select>
            </div>

            <div class="row">
              <label>بحث نصي</label>
              <input id="logSearch" type="text" placeholder="مثال: retry أو timeout..." />
            </div>

            <div class="actions">
              <button class="btn" id="exportLogsBtn">تصدير Logs</button>
              <button class="btn" id="clearLogsBtn">مسح Logs</button>
            </div>
          </div>

          <div class="logbox" id="logBox" aria-label="Logs output"></div>
        </div>
      </div>
    </section>

    <!-- ARTIFACTS -->
    <section class="panel" id="tab-artifacts">
      <div class="card">
        <h2>Artifacts (Evidence Pack)</h2>
        <p class="muted">من هنا تطلع أدلة التجربة: CSV / JSON / PDF.</p>

        <div class="actions">
          <button class="btn primary" id="downloadCsvBtn">تحميل CSV</button>
          <button class="btn" id="downloadJsonBtn">تحميل JSON</button>
          <button class="btn" id="downloadPdfBtn">تحميل PDF (1 صفحة)</button>
        </div>

        <div class="hint">
          <strong>فكرة قوية للجنة:</strong> ارفع الـ PDF/CSV على Zenodo لاحقًا وخذ DOI، واربطه هنا في قسم “Artifacts & DOI”.
        </div>

        <div class="small muted">
          ملاحظة: الـ PDF يتم توليده داخل المتصفح (بدون سيرفر).
        </div>
      </div>
    </section>

    <!-- MAP -->
    <section class="panel" id="tab-map">
      <div class="card">
        <h2>System Map</h2>
        <p class="muted">خريطة توضح مسار الطلب ونقاط القياس (Observability).</p>

        <div class="map">
          <div class="node">Mobile SDK<br/><span class="muted small">HCE / SoftPOS</span></div>
          <div class="arrow">→</div>
          <div class="node">APN Gateway Emulator<br/><span class="muted small">Latency/Loss/Jitter</span></div>
          <div class="arrow">→</div>
          <div class="node">Mock Host / Acquirer<br/><span class="muted small">Approve/Decline</span></div>
          <div class="arrow">→</div>
          <div class="node">Risk Engine<br/><span class="muted small">Rules & Thresholds</span></div>
          <div class="arrow">→</div>
          <div class="node">Token Service<br/><span class="muted small">Provision/Rotate</span></div>
        </div>

        <div class="muted small">
          كل صندوق هنا يمثّل “خدمة وهمية” (Mock) داخل الاختبار. لاحقًا يمكن فصلها لسيرفر بسيط أو Docker.
        </div>
      </div>
    </section>

    <!-- LOCAL -->
    <section class="panel" id="tab-local">
      <div class="card">
        <h2>Run Locally (Reproducibility)</h2>
        <p class="muted">هدفها: أي شخص يقدر يعيد نفس التجربة بنفس الـ Seed ويطلع نفس الـ Artifacts.</p>

        <ol class="list">
          <li>انسخ المستودع</li>
          <li>افتحه على متصفح (Static)</li>
          <li>اختر Scenario + Seed ثم Run</li>
          <li>نزّل Evidence Pack (CSV/JSON/PDF)</li>
        </ol>

        <pre class="code">git clone https://github.com/ahmedaliahmed775/ahmedaliahmed775.github.io.git
cd ahmedaliahmed775.github.io
# افتح index.html في المتصفح
# أو استخدم سيرفر بسيط:
python -m http.server 8080</pre>

        <div class="hint">
          لو تحب، بعد ما يشتغل هذا، نعمل إصدار 2: “Backend Mock Services” على VPS + WebSocket لقياسات أقرب للواقع.
        </div>
      </div>
    </section>
  </main>

  <!-- jsPDF for PDF export (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="assets/app.js"></script>
</body>
</html>
